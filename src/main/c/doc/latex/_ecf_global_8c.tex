\hypertarget{_ecf_global_8c}{\section{Ecf\-Global.\-c File Reference}
\label{_ecf_global_8c}\index{Ecf\-Global.\-c@{Ecf\-Global.\-c}}
}


G\-L\-O\-B\-A\-L A\-N\-A\-L\-Y\-S\-I\-S.  


{\ttfamily \#include $<$stdio.\-h$>$}\\*
{\ttfamily \#include $<$stdlib.\-h$>$}\\*
{\ttfamily \#include $<$math.\-h$>$}\\*
{\ttfamily \#include \char`\"{}Ecf\-Internal.\-h\char`\"{}}\\*
\subsection*{Classes}
\begin{DoxyCompactItemize}
\item 
struct \hyperlink{structglobal__matrix}{global\-\_\-matrix}
\item 
struct \hyperlink{structglobal__vector}{global\-\_\-vector}
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
int \hyperlink{_ecf_global_8c_a07aa4739bad1a824f3c9f94d1d0a3afe}{G\-C\-I\-\_\-marquardt\-\_\-global\-\_\-exps\-\_\-calculate\-\_\-exps\-\_\-instr} (float xincr, int ndata, float instr\mbox{[}$\,$\mbox{]}, int ninstr, int ftype, float param\mbox{[}$\,$\mbox{]}, int nparam, float exp\-\_\-pure\mbox{[}$\,$\mbox{]}, float $\ast$exp\-\_\-conv\mbox{[}$\,$\mbox{]})
\begin{DoxyCompactList}\small\item\em This finds values of exp(-\/x/tau) and x$\ast$exp(-\/x/tau)/tau$^\wedge$2, which are needed later for the multiexponential case, and finds the equivalents in the stretched exponential case. \end{DoxyCompactList}\item 
\hypertarget{_ecf_global_8c_a38c09b1ae952792a119dc2df7b9c135b}{int \hyperlink{_ecf_global_8c_a38c09b1ae952792a119dc2df7b9c135b}{G\-C\-I\-\_\-marquardt\-\_\-global\-\_\-exps\-\_\-do\-\_\-fit\-\_\-single} (float xincr, float y\mbox{[}$\,$\mbox{]}, int ndata, int fit\-\_\-start, int fit\-\_\-end, \hyperlink{_ecf_8h_a603ad628eaeb162f9f6326cbec927b89}{noise\-\_\-type} noise, float sig\mbox{[}$\,$\mbox{]}, int ftype, float param\mbox{[}$\,$\mbox{]}, int paramfree\mbox{[}$\,$\mbox{]}, int nparam, \hyperlink{_ecf_8h_ab577c048e57126ea37f6656e97e547e7}{restrain\-\_\-type} restrain, float chisq\-\_\-delta, float $\ast$exp\-\_\-conv\mbox{[}$\,$\mbox{]}, float $\ast$fitted, float $\ast$residuals, float $\ast$$\ast$covar, float $\ast$$\ast$alpha, float $\ast$chisq)}\label{_ecf_global_8c_a38c09b1ae952792a119dc2df7b9c135b}

\begin{DoxyCompactList}\small\item\em This is just like the normal G\-C\-I\-\_\-marquardt\-\_\-instr, except that it is designed for the multiexp case where we provide the exponential decays in advance, and where we don't care about error axes. \end{DoxyCompactList}\item 
\hypertarget{_ecf_global_8c_aafb1af51dfe25d589eabc954f126f8a4}{int \hyperlink{_ecf_global_8c_aafb1af51dfe25d589eabc954f126f8a4}{G\-C\-I\-\_\-marquardt\-\_\-global\-\_\-exps\-\_\-single\-\_\-step} (float xincr, float y\mbox{[}$\,$\mbox{]}, int ndata, int fit\-\_\-start, int fit\-\_\-end, \hyperlink{_ecf_8h_a603ad628eaeb162f9f6326cbec927b89}{noise\-\_\-type} noise, float sig\mbox{[}$\,$\mbox{]}, int ftype, float param\mbox{[}$\,$\mbox{]}, int paramfree\mbox{[}$\,$\mbox{]}, int nparam, \hyperlink{_ecf_8h_ab577c048e57126ea37f6656e97e547e7}{restrain\-\_\-type} restrain, float $\ast$exp\-\_\-conv\mbox{[}$\,$\mbox{]}, float yfit\mbox{[}$\,$\mbox{]}, float dy\mbox{[}$\,$\mbox{]}, float $\ast$$\ast$covar, float $\ast$$\ast$alpha, float $\ast$chisq, float $\ast$alambda)}\label{_ecf_global_8c_aafb1af51dfe25d589eabc954f126f8a4}

\begin{DoxyCompactList}\small\item\em And this one is basically a specialised G\-C\-I\-\_\-marquardt\-\_\-instr\-\_\-step. \end{DoxyCompactList}\item 
\hypertarget{_ecf_global_8c_a3c2d58a0d97c35ebe96e2eb436d02f63}{int \hyperlink{_ecf_global_8c_a3c2d58a0d97c35ebe96e2eb436d02f63}{G\-C\-I\-\_\-marquardt\-\_\-global\-\_\-compute\-\_\-exps\-\_\-fn} (float xincr, float y\mbox{[}$\,$\mbox{]}, int ndata, int fit\-\_\-start, int fit\-\_\-end, \hyperlink{_ecf_8h_a603ad628eaeb162f9f6326cbec927b89}{noise\-\_\-type} noise, float sig\mbox{[}$\,$\mbox{]}, int ftype, float param\mbox{[}$\,$\mbox{]}, int paramfree\mbox{[}$\,$\mbox{]}, int nparam, float $\ast$exp\-\_\-conv\mbox{[}$\,$\mbox{]}, float yfit\mbox{[}$\,$\mbox{]}, float dy\mbox{[}$\,$\mbox{]}, float $\ast$$\ast$alpha, float $\ast$beta, float $\ast$chisq, float old\-\_\-chisq)}\label{_ecf_global_8c_a3c2d58a0d97c35ebe96e2eb436d02f63}

\begin{DoxyCompactList}\small\item\em This is a streamlined G\-C\-I\-\_\-marquardt\-\_\-compute\-\_\-fn\-\_\-instr. \end{DoxyCompactList}\item 
\hypertarget{_ecf_global_8c_a645102818339935716016f206943084d}{int \hyperlink{_ecf_global_8c_a645102818339935716016f206943084d}{G\-C\-I\-\_\-marquardt\-\_\-global\-\_\-compute\-\_\-exps\-\_\-fn\-\_\-final} (float xincr, float y\mbox{[}$\,$\mbox{]}, int ndata, int fit\-\_\-start, int fit\-\_\-end, \hyperlink{_ecf_8h_a603ad628eaeb162f9f6326cbec927b89}{noise\-\_\-type} noise, float sig\mbox{[}$\,$\mbox{]}, int ftype, float param\mbox{[}$\,$\mbox{]}, int paramfree\mbox{[}$\,$\mbox{]}, int nparam, float $\ast$exp\-\_\-conv\mbox{[}$\,$\mbox{]}, float yfit\mbox{[}$\,$\mbox{]}, float dy\mbox{[}$\,$\mbox{]}, float $\ast$chisq)}\label{_ecf_global_8c_a645102818339935716016f206943084d}

\begin{DoxyCompactList}\small\item\em And this is a final variant which computes the true chi-\/squared values and the full fit, as in \hyperlink{_ecf_single_8c}{Ecf\-Single.\-c}. \end{DoxyCompactList}\item 
int \hyperlink{_ecf_global_8c_a84c451cd77262d9543e4d18d9dcec0d7}{G\-C\-I\-\_\-marquardt\-\_\-global\-\_\-exps\-\_\-do\-\_\-fit\-\_\-instr} (float xincr, float $\ast$$\ast$trans, int ndata, int ntrans, int fit\-\_\-start, int fit\-\_\-end, float instr\mbox{[}$\,$\mbox{]}, int ninstr, \hyperlink{_ecf_8h_a603ad628eaeb162f9f6326cbec927b89}{noise\-\_\-type} noise, float sig\mbox{[}$\,$\mbox{]}, int ftype, float $\ast$$\ast$param, int paramfree\mbox{[}$\,$\mbox{]}, int nparam, \hyperlink{_ecf_8h_ab577c048e57126ea37f6656e97e547e7}{restrain\-\_\-type} restrain, float chisq\-\_\-delta, float exp\-\_\-pure\mbox{[}$\,$\mbox{]}, float $\ast$exp\-\_\-conv\mbox{[}$\,$\mbox{]}, float $\ast$$\ast$fitted, float $\ast$$\ast$residuals, float $\ast$$\ast$covar\-\_\-scratch, float $\ast$$\ast$alpha\-\_\-scratch, float $\ast$chisq\-\_\-trans, float $\ast$chisq\-\_\-global, int drop\-\_\-bad\-\_\-transients)
\begin{DoxyCompactList}\small\item\em This one does the actual global fitting for multiexponential taus. \end{DoxyCompactList}\item 
int \hyperlink{_ecf_global_8c_a1ae474ae7d9529e5a8558285ce4ce119}{G\-C\-I\-\_\-marquardt\-\_\-global\-\_\-exps\-\_\-global\-\_\-step} (float xincr, float $\ast$$\ast$trans, int ndata, int ntrans, int fit\-\_\-start, int fit\-\_\-end, float instr\mbox{[}$\,$\mbox{]}, int ninstr, \hyperlink{_ecf_8h_a603ad628eaeb162f9f6326cbec927b89}{noise\-\_\-type} noise, float sig\mbox{[}$\,$\mbox{]}, int ftype, float $\ast$$\ast$param, int paramfree\mbox{[}$\,$\mbox{]}, int nparam, \hyperlink{_ecf_8h_ab577c048e57126ea37f6656e97e547e7}{restrain\-\_\-type} restrain, float exp\-\_\-pure\mbox{[}$\,$\mbox{]}, float $\ast$exp\-\_\-conv\mbox{[}$\,$\mbox{]}, float $\ast$$\ast$yfit, float $\ast$$\ast$dy, float $\ast$chisq\-\_\-trans, float $\ast$chisq\-\_\-global, float $\ast$$\ast$alpha\-\_\-scratch, float $\ast$alambda, int drop\-\_\-bad\-\_\-transients)
\begin{DoxyCompactList}\small\item\em And this one is basically a specialised G\-C\-I\-\_\-marquardt\-\_\-instr\-\_\-step for the global fitting setup. \end{DoxyCompactList}\item 
\hypertarget{_ecf_global_8c_a41bec0443d67411ff832552b1c9b8a24}{int \hyperlink{_ecf_global_8c_a41bec0443d67411ff832552b1c9b8a24}{G\-C\-I\-\_\-marquardt\-\_\-global\-\_\-compute\-\_\-global\-\_\-exps\-\_\-fn\-\_\-final} (float xincr, float $\ast$$\ast$trans, int ndata, int ntrans, int fit\-\_\-start, int fit\-\_\-end, float instr\mbox{[}$\,$\mbox{]}, int ninstr, \hyperlink{_ecf_8h_a603ad628eaeb162f9f6326cbec927b89}{noise\-\_\-type} noise, float sig\mbox{[}$\,$\mbox{]}, int ftype, float $\ast$$\ast$param, int paramfree\mbox{[}$\,$\mbox{]}, int nparam, int mfit\-\_\-global, int mfit\-\_\-local, int gindex\mbox{[}$\,$\mbox{]}, int lindex\mbox{[}$\,$\mbox{]}, float exp\-\_\-pure\mbox{[}$\,$\mbox{]}, float $\ast$exp\-\_\-conv\mbox{[}$\,$\mbox{]}, float $\ast$$\ast$yfit, float $\ast$$\ast$dy, float $\ast$chisq\-\_\-trans, float $\ast$chisq\-\_\-global, int drop\-\_\-bad\-\_\-transients)}\label{_ecf_global_8c_a41bec0443d67411ff832552b1c9b8a24}

\begin{DoxyCompactList}\small\item\em The final variant. \end{DoxyCompactList}\item 
int \hyperlink{_ecf_global_8c_afa63543768d77a50d2ba83f5ce15b8db}{G\-C\-I\-\_\-marquardt\-\_\-global\-\_\-solve\-\_\-eqn} (\hyperlink{structglobal__matrix}{global\-\_\-matrix} A, \hyperlink{structglobal__vector}{global\-\_\-vector} b, int mfit\-\_\-global, int mfit\-\_\-local, int ntrans)
\begin{DoxyCompactList}\small\item\em G\-C\-I\-\_\-marquardt\-\_\-global\-\_\-solve\-\_\-eqn. \end{DoxyCompactList}\item 
int \hyperlink{_ecf_global_8c_adaf97138127a9b5b4db9de0c15a95742}{G\-C\-I\-\_\-marquardt\-\_\-global\-\_\-exps\-\_\-instr} (float xincr, float $\ast$$\ast$trans, int ndata, int ntrans, int fit\-\_\-start, int fit\-\_\-end, float instr\mbox{[}$\,$\mbox{]}, int ninstr, \hyperlink{_ecf_8h_a603ad628eaeb162f9f6326cbec927b89}{noise\-\_\-type} noise, float sig\mbox{[}$\,$\mbox{]}, int ftype, float $\ast$$\ast$param, int paramfree\mbox{[}$\,$\mbox{]}, int nparam, \hyperlink{_ecf_8h_ab577c048e57126ea37f6656e97e547e7}{restrain\-\_\-type} restrain, float chisq\-\_\-delta, float $\ast$$\ast$fitted, float $\ast$$\ast$residuals, float chisq\-\_\-trans\mbox{[}$\,$\mbox{]}, float $\ast$chisq\-\_\-global, int $\ast$df, int drop\-\_\-bad\-\_\-transients)
\begin{DoxyCompactList}\small\item\em E\-X\-P\-O\-N\-E\-N\-T\-I\-A\-L\-S C\-O\-D\-E. \end{DoxyCompactList}\item 
int \hyperlink{_ecf_global_8c_ac92d80a24a54ae6853e5c49de4e965ab}{G\-C\-I\-\_\-marquardt\-\_\-global\-\_\-generic\-\_\-instr} (float xincr, float $\ast$$\ast$trans, int ndata, int ntrans, int fit\-\_\-start, int fit\-\_\-end, float instr\mbox{[}$\,$\mbox{]}, int ninstr, \hyperlink{_ecf_8h_a603ad628eaeb162f9f6326cbec927b89}{noise\-\_\-type} noise, float sig\mbox{[}$\,$\mbox{]}, float $\ast$$\ast$param, int paramfree\mbox{[}$\,$\mbox{]}, int nparam, int gparam\mbox{[}$\,$\mbox{]}, \hyperlink{_ecf_8h_ab577c048e57126ea37f6656e97e547e7}{restrain\-\_\-type} restrain, float chisq\-\_\-delta, void($\ast$fitfunc)(float, float\mbox{[}$\,$\mbox{]}, float $\ast$, float\mbox{[}$\,$\mbox{]}, int), float $\ast$$\ast$fitted, float $\ast$$\ast$residuals, float chisq\-\_\-trans\mbox{[}$\,$\mbox{]}, float $\ast$chisq\-\_\-global, int $\ast$df)
\begin{DoxyCompactList}\small\item\em G\-E\-N\-E\-R\-I\-C F\-U\-N\-C\-T\-I\-O\-N C\-O\-D\-E. \end{DoxyCompactList}\end{DoxyCompactItemize}


\subsection{Detailed Description}
G\-L\-O\-B\-A\-L A\-N\-A\-L\-Y\-S\-I\-S. We only work with the case of multiple transients, all with the same instrument/prompt response, the same xincr, the same number of points, and so on. The recommended fitting algorithm is a three-\/step process\-:

(1) Sum the transients and use this to get initial estimates for the global parameters we are estimating.

(2) Fixing these parameters, perform a Marquardt fit on each of the transients. In our cases, this will be fairly efficient, as we will not need to repeatedly calculate the exponential decay.

(3) Finally, perform the global fit. There's lots of interesting maths here which we'll discuss when we get to it. Note that again we will not need to repeatedly calculate the exponential decays for each transient, which will hopefully make the process significantly faster.

We provide special code to perform these steps in the case of multiexponential and stretched exponential fits where we are aiming to globally fit all of the taus and the h parameter (in the stretched exponential case); these can be performed far more efficiently than the general case. We also provide code to perform step (3) in the general case; steps (1) and (2) will have to be handled on a case-\/by-\/case basis by the calling code. We also provide a version of step (3) to handle the case of arbitrary x data with no instrument response. 

Definition in file \hyperlink{_ecf_global_8c_source}{Ecf\-Global.\-c}.



\subsection{Function Documentation}
\hypertarget{_ecf_global_8c_a07aa4739bad1a824f3c9f94d1d0a3afe}{\index{Ecf\-Global.\-c@{Ecf\-Global.\-c}!G\-C\-I\-\_\-marquardt\-\_\-global\-\_\-exps\-\_\-calculate\-\_\-exps\-\_\-instr@{G\-C\-I\-\_\-marquardt\-\_\-global\-\_\-exps\-\_\-calculate\-\_\-exps\-\_\-instr}}
\index{G\-C\-I\-\_\-marquardt\-\_\-global\-\_\-exps\-\_\-calculate\-\_\-exps\-\_\-instr@{G\-C\-I\-\_\-marquardt\-\_\-global\-\_\-exps\-\_\-calculate\-\_\-exps\-\_\-instr}!EcfGlobal.c@{Ecf\-Global.\-c}}
\subsubsection[{G\-C\-I\-\_\-marquardt\-\_\-global\-\_\-exps\-\_\-calculate\-\_\-exps\-\_\-instr}]{\setlength{\rightskip}{0pt plus 5cm}int G\-C\-I\-\_\-marquardt\-\_\-global\-\_\-exps\-\_\-calculate\-\_\-exps\-\_\-instr (
\begin{DoxyParamCaption}
\item[{float}]{xincr, }
\item[{int}]{ndata, }
\item[{float}]{instr\mbox{[}$\,$\mbox{]}, }
\item[{int}]{ninstr, }
\item[{int}]{ftype, }
\item[{float}]{param\mbox{[}$\,$\mbox{]}, }
\item[{int}]{nparam, }
\item[{float}]{exp\-\_\-pure\mbox{[}$\,$\mbox{]}, }
\item[{float $\ast$}]{exp\-\_\-conv\mbox{[}$\,$\mbox{]}}
\end{DoxyParamCaption}
)}}\label{_ecf_global_8c_a07aa4739bad1a824f3c9f94d1d0a3afe}


This finds values of exp(-\/x/tau) and x$\ast$exp(-\/x/tau)/tau$^\wedge$2, which are needed later for the multiexponential case, and finds the equivalents in the stretched exponential case. 



Definition at line 969 of file Ecf\-Global.\-c.

\hypertarget{_ecf_global_8c_a84c451cd77262d9543e4d18d9dcec0d7}{\index{Ecf\-Global.\-c@{Ecf\-Global.\-c}!G\-C\-I\-\_\-marquardt\-\_\-global\-\_\-exps\-\_\-do\-\_\-fit\-\_\-instr@{G\-C\-I\-\_\-marquardt\-\_\-global\-\_\-exps\-\_\-do\-\_\-fit\-\_\-instr}}
\index{G\-C\-I\-\_\-marquardt\-\_\-global\-\_\-exps\-\_\-do\-\_\-fit\-\_\-instr@{G\-C\-I\-\_\-marquardt\-\_\-global\-\_\-exps\-\_\-do\-\_\-fit\-\_\-instr}!EcfGlobal.c@{Ecf\-Global.\-c}}
\subsubsection[{G\-C\-I\-\_\-marquardt\-\_\-global\-\_\-exps\-\_\-do\-\_\-fit\-\_\-instr}]{\setlength{\rightskip}{0pt plus 5cm}int G\-C\-I\-\_\-marquardt\-\_\-global\-\_\-exps\-\_\-do\-\_\-fit\-\_\-instr (
\begin{DoxyParamCaption}
\item[{float}]{xincr, }
\item[{float $\ast$$\ast$}]{trans, }
\item[{int}]{ndata, }
\item[{int}]{ntrans, }
\item[{int}]{fit\-\_\-start, }
\item[{int}]{fit\-\_\-end, }
\item[{float}]{instr\mbox{[}$\,$\mbox{]}, }
\item[{int}]{ninstr, }
\item[{{\bf noise\-\_\-type}}]{noise, }
\item[{float}]{sig\mbox{[}$\,$\mbox{]}, }
\item[{int}]{ftype, }
\item[{float $\ast$$\ast$}]{param, }
\item[{int}]{paramfree\mbox{[}$\,$\mbox{]}, }
\item[{int}]{nparam, }
\item[{{\bf restrain\-\_\-type}}]{restrain, }
\item[{float}]{chisq\-\_\-delta, }
\item[{float}]{exp\-\_\-pure\mbox{[}$\,$\mbox{]}, }
\item[{float $\ast$}]{exp\-\_\-conv\mbox{[}$\,$\mbox{]}, }
\item[{float $\ast$$\ast$}]{fitted, }
\item[{float $\ast$$\ast$}]{residuals, }
\item[{float $\ast$$\ast$}]{covar\-\_\-scratch, }
\item[{float $\ast$$\ast$}]{alpha\-\_\-scratch, }
\item[{float $\ast$}]{chisq\-\_\-trans, }
\item[{float $\ast$}]{chisq\-\_\-global, }
\item[{int}]{drop\-\_\-bad\-\_\-transients}
\end{DoxyParamCaption}
)}}\label{_ecf_global_8c_a84c451cd77262d9543e4d18d9dcec0d7}


This one does the actual global fitting for multiexponential taus. 

It is basically similar to the above do\-\_\-fit\-\_\-single function, except that now we handle the extra intricacies involved in global fitting, in particular, the much larger alpha matrix is handled in a special way. 

Definition at line 1941 of file Ecf\-Global.\-c.

\hypertarget{_ecf_global_8c_a1ae474ae7d9529e5a8558285ce4ce119}{\index{Ecf\-Global.\-c@{Ecf\-Global.\-c}!G\-C\-I\-\_\-marquardt\-\_\-global\-\_\-exps\-\_\-global\-\_\-step@{G\-C\-I\-\_\-marquardt\-\_\-global\-\_\-exps\-\_\-global\-\_\-step}}
\index{G\-C\-I\-\_\-marquardt\-\_\-global\-\_\-exps\-\_\-global\-\_\-step@{G\-C\-I\-\_\-marquardt\-\_\-global\-\_\-exps\-\_\-global\-\_\-step}!EcfGlobal.c@{Ecf\-Global.\-c}}
\subsubsection[{G\-C\-I\-\_\-marquardt\-\_\-global\-\_\-exps\-\_\-global\-\_\-step}]{\setlength{\rightskip}{0pt plus 5cm}int G\-C\-I\-\_\-marquardt\-\_\-global\-\_\-exps\-\_\-global\-\_\-step (
\begin{DoxyParamCaption}
\item[{float}]{xincr, }
\item[{float $\ast$$\ast$}]{trans, }
\item[{int}]{ndata, }
\item[{int}]{ntrans, }
\item[{int}]{fit\-\_\-start, }
\item[{int}]{fit\-\_\-end, }
\item[{float}]{instr\mbox{[}$\,$\mbox{]}, }
\item[{int}]{ninstr, }
\item[{{\bf noise\-\_\-type}}]{noise, }
\item[{float}]{sig\mbox{[}$\,$\mbox{]}, }
\item[{int}]{ftype, }
\item[{float $\ast$$\ast$}]{param, }
\item[{int}]{paramfree\mbox{[}$\,$\mbox{]}, }
\item[{int}]{nparam, }
\item[{{\bf restrain\-\_\-type}}]{restrain, }
\item[{float}]{exp\-\_\-pure\mbox{[}$\,$\mbox{]}, }
\item[{float $\ast$}]{exp\-\_\-conv\mbox{[}$\,$\mbox{]}, }
\item[{float $\ast$$\ast$}]{yfit, }
\item[{float $\ast$$\ast$}]{dy, }
\item[{float $\ast$}]{chisq\-\_\-trans, }
\item[{float $\ast$}]{chisq\-\_\-global, }
\item[{float $\ast$$\ast$}]{alpha\-\_\-scratch, }
\item[{float $\ast$}]{alambda, }
\item[{int}]{drop\-\_\-bad\-\_\-transients}
\end{DoxyParamCaption}
)}}\label{_ecf_global_8c_a1ae474ae7d9529e5a8558285ce4ce119}


And this one is basically a specialised G\-C\-I\-\_\-marquardt\-\_\-instr\-\_\-step for the global fitting setup. 



Definition at line 2132 of file Ecf\-Global.\-c.

\hypertarget{_ecf_global_8c_adaf97138127a9b5b4db9de0c15a95742}{\index{Ecf\-Global.\-c@{Ecf\-Global.\-c}!G\-C\-I\-\_\-marquardt\-\_\-global\-\_\-exps\-\_\-instr@{G\-C\-I\-\_\-marquardt\-\_\-global\-\_\-exps\-\_\-instr}}
\index{G\-C\-I\-\_\-marquardt\-\_\-global\-\_\-exps\-\_\-instr@{G\-C\-I\-\_\-marquardt\-\_\-global\-\_\-exps\-\_\-instr}!EcfGlobal.c@{Ecf\-Global.\-c}}
\subsubsection[{G\-C\-I\-\_\-marquardt\-\_\-global\-\_\-exps\-\_\-instr}]{\setlength{\rightskip}{0pt plus 5cm}int G\-C\-I\-\_\-marquardt\-\_\-global\-\_\-exps\-\_\-instr (
\begin{DoxyParamCaption}
\item[{float}]{xincr, }
\item[{float $\ast$$\ast$}]{trans, }
\item[{int}]{ndata, }
\item[{int}]{ntrans, }
\item[{int}]{fit\-\_\-start, }
\item[{int}]{fit\-\_\-end, }
\item[{float}]{instr\mbox{[}$\,$\mbox{]}, }
\item[{int}]{ninstr, }
\item[{{\bf noise\-\_\-type}}]{noise, }
\item[{float}]{sig\mbox{[}$\,$\mbox{]}, }
\item[{int}]{ftype, }
\item[{float $\ast$$\ast$}]{param, }
\item[{int}]{paramfree\mbox{[}$\,$\mbox{]}, }
\item[{int}]{nparam, }
\item[{{\bf restrain\-\_\-type}}]{restrain, }
\item[{float}]{chisq\-\_\-delta, }
\item[{float $\ast$$\ast$}]{fitted, }
\item[{float $\ast$$\ast$}]{residuals, }
\item[{float}]{chisq\-\_\-trans\mbox{[}$\,$\mbox{]}, }
\item[{float $\ast$}]{chisq\-\_\-global, }
\item[{int $\ast$}]{df, }
\item[{int}]{drop\-\_\-bad\-\_\-transients}
\end{DoxyParamCaption}
)}}\label{_ecf_global_8c_adaf97138127a9b5b4db9de0c15a95742}


E\-X\-P\-O\-N\-E\-N\-T\-I\-A\-L\-S C\-O\-D\-E. 

Global analysis analysis function for exponential functions.

Now the code for performing a global fit for multi-\/exponential taus and stretched exponentials. This is the function which is called from external programs. 

Definition at line 356 of file Ecf\-Global.\-c.

\hypertarget{_ecf_global_8c_ac92d80a24a54ae6853e5c49de4e965ab}{\index{Ecf\-Global.\-c@{Ecf\-Global.\-c}!G\-C\-I\-\_\-marquardt\-\_\-global\-\_\-generic\-\_\-instr@{G\-C\-I\-\_\-marquardt\-\_\-global\-\_\-generic\-\_\-instr}}
\index{G\-C\-I\-\_\-marquardt\-\_\-global\-\_\-generic\-\_\-instr@{G\-C\-I\-\_\-marquardt\-\_\-global\-\_\-generic\-\_\-instr}!EcfGlobal.c@{Ecf\-Global.\-c}}
\subsubsection[{G\-C\-I\-\_\-marquardt\-\_\-global\-\_\-generic\-\_\-instr}]{\setlength{\rightskip}{0pt plus 5cm}int G\-C\-I\-\_\-marquardt\-\_\-global\-\_\-generic\-\_\-instr (
\begin{DoxyParamCaption}
\item[{float}]{xincr, }
\item[{float $\ast$$\ast$}]{trans, }
\item[{int}]{ndata, }
\item[{int}]{ntrans, }
\item[{int}]{fit\-\_\-start, }
\item[{int}]{fit\-\_\-end, }
\item[{float}]{instr\mbox{[}$\,$\mbox{]}, }
\item[{int}]{ninstr, }
\item[{{\bf noise\-\_\-type}}]{noise, }
\item[{float}]{sig\mbox{[}$\,$\mbox{]}, }
\item[{float $\ast$$\ast$}]{param, }
\item[{int}]{paramfree\mbox{[}$\,$\mbox{]}, }
\item[{int}]{nparam, }
\item[{int}]{gparam\mbox{[}$\,$\mbox{]}, }
\item[{{\bf restrain\-\_\-type}}]{restrain, }
\item[{float}]{chisq\-\_\-delta, }
\item[{void($\ast$)(float, float\mbox{[}$\,$\mbox{]}, float $\ast$, float\mbox{[}$\,$\mbox{]}, int)}]{fitfunc, }
\item[{float $\ast$$\ast$}]{fitted, }
\item[{float $\ast$$\ast$}]{residuals, }
\item[{float}]{chisq\-\_\-trans\mbox{[}$\,$\mbox{]}, }
\item[{float $\ast$}]{chisq\-\_\-global, }
\item[{int $\ast$}]{df}
\end{DoxyParamCaption}
)}}\label{_ecf_global_8c_ac92d80a24a54ae6853e5c49de4e965ab}


G\-E\-N\-E\-R\-I\-C F\-U\-N\-C\-T\-I\-O\-N C\-O\-D\-E. 

Global analysis analysis function for generic functions.

These functions are essentially the same as the above functions G\-C\-I\-\_\-marquardt\-\_\-global\-\_\-exps\-\_\-instr and G\-C\-I\-\_\-marquardt\-\_\-global\-\_\-exps\-\_\-do\-\_\-fit\-\_\-instr and the latter's dependents, except that this version takes an arbitrary function and a list of global parameters. This function is designed to be called from external code. It is nowhere near as efficient as the streamlined code above for globally fitting taus for multi-\/exponential models. Also, this function must be provided with meaningful starting estimates for all parameters. 

Definition at line 2707 of file Ecf\-Global.\-c.

\hypertarget{_ecf_global_8c_afa63543768d77a50d2ba83f5ce15b8db}{\index{Ecf\-Global.\-c@{Ecf\-Global.\-c}!G\-C\-I\-\_\-marquardt\-\_\-global\-\_\-solve\-\_\-eqn@{G\-C\-I\-\_\-marquardt\-\_\-global\-\_\-solve\-\_\-eqn}}
\index{G\-C\-I\-\_\-marquardt\-\_\-global\-\_\-solve\-\_\-eqn@{G\-C\-I\-\_\-marquardt\-\_\-global\-\_\-solve\-\_\-eqn}!EcfGlobal.c@{Ecf\-Global.\-c}}
\subsubsection[{G\-C\-I\-\_\-marquardt\-\_\-global\-\_\-solve\-\_\-eqn}]{\setlength{\rightskip}{0pt plus 5cm}int G\-C\-I\-\_\-marquardt\-\_\-global\-\_\-solve\-\_\-eqn (
\begin{DoxyParamCaption}
\item[{{\bf global\-\_\-matrix}}]{A, }
\item[{{\bf global\-\_\-vector}}]{b, }
\item[{int}]{mfit\-\_\-global, }
\item[{int}]{mfit\-\_\-local, }
\item[{int}]{ntrans}
\end{DoxyParamCaption}
)}}\label{_ecf_global_8c_afa63543768d77a50d2ba83f5ce15b8db}


G\-C\-I\-\_\-marquardt\-\_\-global\-\_\-solve\-\_\-eqn. 

This function solves the equation Ax=b, where A is the alpha matrix, which has the form\-:

A = (P Q) (R S)

Here P is an mfit\-\_\-global x mfit\-\_\-global square matrix, S is a block diagonal matrix with ntrans blocks, each of size mfit\-\_\-local x mfit\-\_\-local, and Q and R are the right sizes to make the whole matrix square. We solve it by inverting the matrix A using the formulae given in Numerical Recipes section 2.\-7, then multiplying the inverse by b to get x. We are not too concerned about accuracy, as this does not affect the solution found, only the route taken to find it.

Numerical Recipes, section 2.\-7, notes that A$^\wedge$\{-\/1\} is given by\-:

(P' Q') (R' S')

with\-:

P' = (P -\/ Q.\-S$^\wedge$\{-\/1\}.R)$^\wedge$\{-\/1\} Q' = -\/ (P -\/ Q.\-S$^\wedge$\{-\/1\}.R)$^\wedge$\{-\/1\} . (Q.\-S$^\wedge$\{-\/1\}) R' = -\/ (S$^\wedge$\{-\/1\}.R) . (P -\/ Q.\-S$^\wedge$\{-\/1\}.R)$^\wedge$\{-\/1\} S' = S$^\wedge$\{-\/1\} + (S$^\wedge$\{-\/1\}.R) . (P -\/ Q.\-S$^\wedge$\{-\/1\}.R)$^\wedge$\{-\/1\} . (Q.\-S$^\wedge$\{-\/1\})

We also make use of the fact that A is symmetric, so in particular, (S$^\wedge$\{-\/1\}.R) = (Q.\-S$^\wedge$\{-\/1\})$^\wedge$\-T and R' = Q'$^\wedge$\-T.

We are given A as a \hyperlink{structglobal__matrix}{global\-\_\-matrix} and b as a \hyperlink{structglobal__vector}{global\-\_\-vector}. This function destroys the original matrix and returns the solution in place of b. 

Definition at line 2556 of file Ecf\-Global.\-c.

