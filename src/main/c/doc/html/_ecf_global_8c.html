<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>SLIM Curve: EcfGlobal.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">SLIM Curve
   &#160;<span id="projectnumber">1</span>
   </div>
   <div id="projectbrief">SLIM-curve package for exponential curve fitting of spectral lifetime data.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">EcfGlobal.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>GLOBAL ANALYSIS.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;stdio.h&gt;</code><br/>
<code>#include &lt;stdlib.h&gt;</code><br/>
<code>#include &lt;math.h&gt;</code><br/>
<code>#include &quot;EcfInternal.h&quot;</code><br/>
</div>
<p><a href="_ecf_global_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structglobal__matrix.html">global_matrix</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structglobal__vector.html">global_vector</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a07aa4739bad1a824f3c9f94d1d0a3afe"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_ecf_global_8c.html#a07aa4739bad1a824f3c9f94d1d0a3afe">GCI_marquardt_global_exps_calculate_exps_instr</a> (float xincr, int ndata, float instr[], int ninstr, int ftype, float param[], int nparam, float exp_pure[], float *exp_conv[])</td></tr>
<tr class="memdesc:a07aa4739bad1a824f3c9f94d1d0a3afe"><td class="mdescLeft">&#160;</td><td class="mdescRight">This finds values of exp(-x/tau) and x*exp(-x/tau)/tau^2, which are needed later for the multiexponential case, and finds the equivalents in the stretched exponential case.  <a href="#a07aa4739bad1a824f3c9f94d1d0a3afe">More...</a><br/></td></tr>
<tr class="separator:a07aa4739bad1a824f3c9f94d1d0a3afe"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a38c09b1ae952792a119dc2df7b9c135b"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a38c09b1ae952792a119dc2df7b9c135b"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_ecf_global_8c.html#a38c09b1ae952792a119dc2df7b9c135b">GCI_marquardt_global_exps_do_fit_single</a> (float xincr, float y[], int ndata, int fit_start, int fit_end, <a class="el" href="_ecf_8h.html#a603ad628eaeb162f9f6326cbec927b89">noise_type</a> noise, float sig[], int ftype, float param[], int paramfree[], int nparam, <a class="el" href="_ecf_8h.html#ab577c048e57126ea37f6656e97e547e7">restrain_type</a> restrain, float chisq_delta, float *exp_conv[], float *fitted, float *residuals, float **covar, float **alpha, float *chisq)</td></tr>
<tr class="memdesc:a38c09b1ae952792a119dc2df7b9c135b"><td class="mdescLeft">&#160;</td><td class="mdescRight">This is just like the normal GCI_marquardt_instr, except that it is designed for the multiexp case where we provide the exponential decays in advance, and where we don't care about error axes. <br/></td></tr>
<tr class="separator:a38c09b1ae952792a119dc2df7b9c135b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aafb1af51dfe25d589eabc954f126f8a4"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="aafb1af51dfe25d589eabc954f126f8a4"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_ecf_global_8c.html#aafb1af51dfe25d589eabc954f126f8a4">GCI_marquardt_global_exps_single_step</a> (float xincr, float y[], int ndata, int fit_start, int fit_end, <a class="el" href="_ecf_8h.html#a603ad628eaeb162f9f6326cbec927b89">noise_type</a> noise, float sig[], int ftype, float param[], int paramfree[], int nparam, <a class="el" href="_ecf_8h.html#ab577c048e57126ea37f6656e97e547e7">restrain_type</a> restrain, float *exp_conv[], float yfit[], float dy[], float **covar, float **alpha, float *chisq, float *alambda)</td></tr>
<tr class="memdesc:aafb1af51dfe25d589eabc954f126f8a4"><td class="mdescLeft">&#160;</td><td class="mdescRight">And this one is basically a specialised GCI_marquardt_instr_step. <br/></td></tr>
<tr class="separator:aafb1af51dfe25d589eabc954f126f8a4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3c2d58a0d97c35ebe96e2eb436d02f63"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a3c2d58a0d97c35ebe96e2eb436d02f63"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_ecf_global_8c.html#a3c2d58a0d97c35ebe96e2eb436d02f63">GCI_marquardt_global_compute_exps_fn</a> (float xincr, float y[], int ndata, int fit_start, int fit_end, <a class="el" href="_ecf_8h.html#a603ad628eaeb162f9f6326cbec927b89">noise_type</a> noise, float sig[], int ftype, float param[], int paramfree[], int nparam, float *exp_conv[], float yfit[], float dy[], float **alpha, float *beta, float *chisq, float old_chisq)</td></tr>
<tr class="memdesc:a3c2d58a0d97c35ebe96e2eb436d02f63"><td class="mdescLeft">&#160;</td><td class="mdescRight">This is a streamlined GCI_marquardt_compute_fn_instr. <br/></td></tr>
<tr class="separator:a3c2d58a0d97c35ebe96e2eb436d02f63"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a645102818339935716016f206943084d"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a645102818339935716016f206943084d"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_ecf_global_8c.html#a645102818339935716016f206943084d">GCI_marquardt_global_compute_exps_fn_final</a> (float xincr, float y[], int ndata, int fit_start, int fit_end, <a class="el" href="_ecf_8h.html#a603ad628eaeb162f9f6326cbec927b89">noise_type</a> noise, float sig[], int ftype, float param[], int paramfree[], int nparam, float *exp_conv[], float yfit[], float dy[], float *chisq)</td></tr>
<tr class="memdesc:a645102818339935716016f206943084d"><td class="mdescLeft">&#160;</td><td class="mdescRight">And this is a final variant which computes the true chi-squared values and the full fit, as in <a class="el" href="_ecf_single_8c.html" title="SLIM Curve - Exponential Curve Fitting. ">EcfSingle.c</a>. <br/></td></tr>
<tr class="separator:a645102818339935716016f206943084d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a84c451cd77262d9543e4d18d9dcec0d7"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_ecf_global_8c.html#a84c451cd77262d9543e4d18d9dcec0d7">GCI_marquardt_global_exps_do_fit_instr</a> (float xincr, float **trans, int ndata, int ntrans, int fit_start, int fit_end, float instr[], int ninstr, <a class="el" href="_ecf_8h.html#a603ad628eaeb162f9f6326cbec927b89">noise_type</a> noise, float sig[], int ftype, float **param, int paramfree[], int nparam, <a class="el" href="_ecf_8h.html#ab577c048e57126ea37f6656e97e547e7">restrain_type</a> restrain, float chisq_delta, float exp_pure[], float *exp_conv[], float **fitted, float **residuals, float **covar_scratch, float **alpha_scratch, float *chisq_trans, float *chisq_global, int drop_bad_transients)</td></tr>
<tr class="memdesc:a84c451cd77262d9543e4d18d9dcec0d7"><td class="mdescLeft">&#160;</td><td class="mdescRight">This one does the actual global fitting for multiexponential taus.  <a href="#a84c451cd77262d9543e4d18d9dcec0d7">More...</a><br/></td></tr>
<tr class="separator:a84c451cd77262d9543e4d18d9dcec0d7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1ae474ae7d9529e5a8558285ce4ce119"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_ecf_global_8c.html#a1ae474ae7d9529e5a8558285ce4ce119">GCI_marquardt_global_exps_global_step</a> (float xincr, float **trans, int ndata, int ntrans, int fit_start, int fit_end, float instr[], int ninstr, <a class="el" href="_ecf_8h.html#a603ad628eaeb162f9f6326cbec927b89">noise_type</a> noise, float sig[], int ftype, float **param, int paramfree[], int nparam, <a class="el" href="_ecf_8h.html#ab577c048e57126ea37f6656e97e547e7">restrain_type</a> restrain, float exp_pure[], float *exp_conv[], float **yfit, float **dy, float *chisq_trans, float *chisq_global, float **alpha_scratch, float *alambda, int drop_bad_transients)</td></tr>
<tr class="memdesc:a1ae474ae7d9529e5a8558285ce4ce119"><td class="mdescLeft">&#160;</td><td class="mdescRight">And this one is basically a specialised GCI_marquardt_instr_step for the global fitting setup.  <a href="#a1ae474ae7d9529e5a8558285ce4ce119">More...</a><br/></td></tr>
<tr class="separator:a1ae474ae7d9529e5a8558285ce4ce119"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a41bec0443d67411ff832552b1c9b8a24"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a41bec0443d67411ff832552b1c9b8a24"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_ecf_global_8c.html#a41bec0443d67411ff832552b1c9b8a24">GCI_marquardt_global_compute_global_exps_fn_final</a> (float xincr, float **trans, int ndata, int ntrans, int fit_start, int fit_end, float instr[], int ninstr, <a class="el" href="_ecf_8h.html#a603ad628eaeb162f9f6326cbec927b89">noise_type</a> noise, float sig[], int ftype, float **param, int paramfree[], int nparam, int mfit_global, int mfit_local, int gindex[], int lindex[], float exp_pure[], float *exp_conv[], float **yfit, float **dy, float *chisq_trans, float *chisq_global, int drop_bad_transients)</td></tr>
<tr class="memdesc:a41bec0443d67411ff832552b1c9b8a24"><td class="mdescLeft">&#160;</td><td class="mdescRight">The final variant. <br/></td></tr>
<tr class="separator:a41bec0443d67411ff832552b1c9b8a24"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afa63543768d77a50d2ba83f5ce15b8db"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_ecf_global_8c.html#afa63543768d77a50d2ba83f5ce15b8db">GCI_marquardt_global_solve_eqn</a> (<a class="el" href="structglobal__matrix.html">global_matrix</a> A, <a class="el" href="structglobal__vector.html">global_vector</a> b, int mfit_global, int mfit_local, int ntrans)</td></tr>
<tr class="memdesc:afa63543768d77a50d2ba83f5ce15b8db"><td class="mdescLeft">&#160;</td><td class="mdescRight">GCI_marquardt_global_solve_eqn.  <a href="#afa63543768d77a50d2ba83f5ce15b8db">More...</a><br/></td></tr>
<tr class="separator:afa63543768d77a50d2ba83f5ce15b8db"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adaf97138127a9b5b4db9de0c15a95742"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_ecf_global_8c.html#adaf97138127a9b5b4db9de0c15a95742">GCI_marquardt_global_exps_instr</a> (float xincr, float **trans, int ndata, int ntrans, int fit_start, int fit_end, float instr[], int ninstr, <a class="el" href="_ecf_8h.html#a603ad628eaeb162f9f6326cbec927b89">noise_type</a> noise, float sig[], int ftype, float **param, int paramfree[], int nparam, <a class="el" href="_ecf_8h.html#ab577c048e57126ea37f6656e97e547e7">restrain_type</a> restrain, float chisq_delta, float **fitted, float **residuals, float chisq_trans[], float *chisq_global, int *df, int drop_bad_transients)</td></tr>
<tr class="memdesc:adaf97138127a9b5b4db9de0c15a95742"><td class="mdescLeft">&#160;</td><td class="mdescRight">EXPONENTIALS CODE.  <a href="#adaf97138127a9b5b4db9de0c15a95742">More...</a><br/></td></tr>
<tr class="separator:adaf97138127a9b5b4db9de0c15a95742"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac92d80a24a54ae6853e5c49de4e965ab"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_ecf_global_8c.html#ac92d80a24a54ae6853e5c49de4e965ab">GCI_marquardt_global_generic_instr</a> (float xincr, float **trans, int ndata, int ntrans, int fit_start, int fit_end, float instr[], int ninstr, <a class="el" href="_ecf_8h.html#a603ad628eaeb162f9f6326cbec927b89">noise_type</a> noise, float sig[], float **param, int paramfree[], int nparam, int gparam[], <a class="el" href="_ecf_8h.html#ab577c048e57126ea37f6656e97e547e7">restrain_type</a> restrain, float chisq_delta, void(*fitfunc)(float, float[], float *, float[], int), float **fitted, float **residuals, float chisq_trans[], float *chisq_global, int *df)</td></tr>
<tr class="memdesc:ac92d80a24a54ae6853e5c49de4e965ab"><td class="mdescLeft">&#160;</td><td class="mdescRight">GENERIC FUNCTION CODE.  <a href="#ac92d80a24a54ae6853e5c49de4e965ab">More...</a><br/></td></tr>
<tr class="separator:ac92d80a24a54ae6853e5c49de4e965ab"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>GLOBAL ANALYSIS. </p>
<p>We only work with the case of multiple transients, all with the same instrument/prompt response, the same xincr, the same number of points, and so on. The recommended fitting algorithm is a three-step process:</p>
<p>(1) Sum the transients and use this to get initial estimates for the global parameters we are estimating.</p>
<p>(2) Fixing these parameters, perform a Marquardt fit on each of the transients. In our cases, this will be fairly efficient, as we will not need to repeatedly calculate the exponential decay.</p>
<p>(3) Finally, perform the global fit. There's lots of interesting maths here which we'll discuss when we get to it. Note that again we will not need to repeatedly calculate the exponential decays for each transient, which will hopefully make the process significantly faster.</p>
<p>We provide special code to perform these steps in the case of multiexponential and stretched exponential fits where we are aiming to globally fit all of the taus and the h parameter (in the stretched exponential case); these can be performed far more efficiently than the general case. We also provide code to perform step (3) in the general case; steps (1) and (2) will have to be handled on a case-by-case basis by the calling code. We also provide a version of step (3) to handle the case of arbitrary x data with no instrument response. </p>

<p>Definition in file <a class="el" href="_ecf_global_8c_source.html">EcfGlobal.c</a>.</p>
</div><h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="a07aa4739bad1a824f3c9f94d1d0a3afe"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int GCI_marquardt_global_exps_calculate_exps_instr </td>
          <td>(</td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>xincr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ndata</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>instr</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ninstr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ftype</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>param</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nparam</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>exp_pure</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float *&#160;</td>
          <td class="paramname"><em>exp_conv</em>[]&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This finds values of exp(-x/tau) and x*exp(-x/tau)/tau^2, which are needed later for the multiexponential case, and finds the equivalents in the stretched exponential case. </p>

<p>Definition at line <a class="el" href="_ecf_global_8c_source.html#l00969">969</a> of file <a class="el" href="_ecf_global_8c_source.html">EcfGlobal.c</a>.</p>

</div>
</div>
<a class="anchor" id="a84c451cd77262d9543e4d18d9dcec0d7"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int GCI_marquardt_global_exps_do_fit_instr </td>
          <td>(</td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>xincr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float **&#160;</td>
          <td class="paramname"><em>trans</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ndata</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ntrans</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>fit_start</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>fit_end</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>instr</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ninstr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="_ecf_8h.html#a603ad628eaeb162f9f6326cbec927b89">noise_type</a>&#160;</td>
          <td class="paramname"><em>noise</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>sig</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ftype</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float **&#160;</td>
          <td class="paramname"><em>param</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>paramfree</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nparam</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="_ecf_8h.html#ab577c048e57126ea37f6656e97e547e7">restrain_type</a>&#160;</td>
          <td class="paramname"><em>restrain</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>chisq_delta</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>exp_pure</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float *&#160;</td>
          <td class="paramname"><em>exp_conv</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float **&#160;</td>
          <td class="paramname"><em>fitted</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float **&#160;</td>
          <td class="paramname"><em>residuals</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float **&#160;</td>
          <td class="paramname"><em>covar_scratch</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float **&#160;</td>
          <td class="paramname"><em>alpha_scratch</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float *&#160;</td>
          <td class="paramname"><em>chisq_trans</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float *&#160;</td>
          <td class="paramname"><em>chisq_global</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>drop_bad_transients</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>This one does the actual global fitting for multiexponential taus. </p>
<p>It is basically similar to the above do_fit_single function, except that now we handle the extra intricacies involved in global fitting, in particular, the much larger alpha matrix is handled in a special way. </p>

<p>Definition at line <a class="el" href="_ecf_global_8c_source.html#l01941">1941</a> of file <a class="el" href="_ecf_global_8c_source.html">EcfGlobal.c</a>.</p>

</div>
</div>
<a class="anchor" id="a1ae474ae7d9529e5a8558285ce4ce119"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int GCI_marquardt_global_exps_global_step </td>
          <td>(</td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>xincr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float **&#160;</td>
          <td class="paramname"><em>trans</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ndata</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ntrans</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>fit_start</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>fit_end</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>instr</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ninstr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="_ecf_8h.html#a603ad628eaeb162f9f6326cbec927b89">noise_type</a>&#160;</td>
          <td class="paramname"><em>noise</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>sig</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ftype</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float **&#160;</td>
          <td class="paramname"><em>param</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>paramfree</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nparam</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="_ecf_8h.html#ab577c048e57126ea37f6656e97e547e7">restrain_type</a>&#160;</td>
          <td class="paramname"><em>restrain</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>exp_pure</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float *&#160;</td>
          <td class="paramname"><em>exp_conv</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float **&#160;</td>
          <td class="paramname"><em>yfit</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float **&#160;</td>
          <td class="paramname"><em>dy</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float *&#160;</td>
          <td class="paramname"><em>chisq_trans</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float *&#160;</td>
          <td class="paramname"><em>chisq_global</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float **&#160;</td>
          <td class="paramname"><em>alpha_scratch</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float *&#160;</td>
          <td class="paramname"><em>alambda</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>drop_bad_transients</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>And this one is basically a specialised GCI_marquardt_instr_step for the global fitting setup. </p>

<p>Definition at line <a class="el" href="_ecf_global_8c_source.html#l02132">2132</a> of file <a class="el" href="_ecf_global_8c_source.html">EcfGlobal.c</a>.</p>

</div>
</div>
<a class="anchor" id="adaf97138127a9b5b4db9de0c15a95742"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int GCI_marquardt_global_exps_instr </td>
          <td>(</td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>xincr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float **&#160;</td>
          <td class="paramname"><em>trans</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ndata</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ntrans</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>fit_start</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>fit_end</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>instr</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ninstr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="_ecf_8h.html#a603ad628eaeb162f9f6326cbec927b89">noise_type</a>&#160;</td>
          <td class="paramname"><em>noise</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>sig</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ftype</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float **&#160;</td>
          <td class="paramname"><em>param</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>paramfree</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nparam</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="_ecf_8h.html#ab577c048e57126ea37f6656e97e547e7">restrain_type</a>&#160;</td>
          <td class="paramname"><em>restrain</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>chisq_delta</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float **&#160;</td>
          <td class="paramname"><em>fitted</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float **&#160;</td>
          <td class="paramname"><em>residuals</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>chisq_trans</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float *&#160;</td>
          <td class="paramname"><em>chisq_global</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>df</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>drop_bad_transients</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>EXPONENTIALS CODE. </p>
<p>Global analysis analysis function for exponential functions.</p>
<p>Now the code for performing a global fit for multi-exponential taus and stretched exponentials. This is the function which is called from external programs. </p>

<p>Definition at line <a class="el" href="_ecf_global_8c_source.html#l00356">356</a> of file <a class="el" href="_ecf_global_8c_source.html">EcfGlobal.c</a>.</p>

</div>
</div>
<a class="anchor" id="ac92d80a24a54ae6853e5c49de4e965ab"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int GCI_marquardt_global_generic_instr </td>
          <td>(</td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>xincr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float **&#160;</td>
          <td class="paramname"><em>trans</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ndata</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ntrans</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>fit_start</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>fit_end</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>instr</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ninstr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="_ecf_8h.html#a603ad628eaeb162f9f6326cbec927b89">noise_type</a>&#160;</td>
          <td class="paramname"><em>noise</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>sig</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float **&#160;</td>
          <td class="paramname"><em>param</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>paramfree</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nparam</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>gparam</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="_ecf_8h.html#ab577c048e57126ea37f6656e97e547e7">restrain_type</a>&#160;</td>
          <td class="paramname"><em>restrain</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>chisq_delta</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void(*)(float, float[], float *, float[], int)&#160;</td>
          <td class="paramname"><em>fitfunc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float **&#160;</td>
          <td class="paramname"><em>fitted</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float **&#160;</td>
          <td class="paramname"><em>residuals</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>chisq_trans</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float *&#160;</td>
          <td class="paramname"><em>chisq_global</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>df</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>GENERIC FUNCTION CODE. </p>
<p>Global analysis analysis function for generic functions.</p>
<p>These functions are essentially the same as the above functions GCI_marquardt_global_exps_instr and GCI_marquardt_global_exps_do_fit_instr and the latter's dependents, except that this version takes an arbitrary function and a list of global parameters. This function is designed to be called from external code. It is nowhere near as efficient as the streamlined code above for globally fitting taus for multi-exponential models. Also, this function must be provided with meaningful starting estimates for all parameters. </p>

<p>Definition at line <a class="el" href="_ecf_global_8c_source.html#l02707">2707</a> of file <a class="el" href="_ecf_global_8c_source.html">EcfGlobal.c</a>.</p>

</div>
</div>
<a class="anchor" id="afa63543768d77a50d2ba83f5ce15b8db"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int GCI_marquardt_global_solve_eqn </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structglobal__matrix.html">global_matrix</a>&#160;</td>
          <td class="paramname"><em>A</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structglobal__vector.html">global_vector</a>&#160;</td>
          <td class="paramname"><em>b</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>mfit_global</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>mfit_local</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ntrans</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>GCI_marquardt_global_solve_eqn. </p>
<p>This function solves the equation Ax=b, where A is the alpha matrix, which has the form:</p>
<p>A = (P Q) (R S)</p>
<p>Here P is an mfit_global x mfit_global square matrix, S is a block diagonal matrix with ntrans blocks, each of size mfit_local x mfit_local, and Q and R are the right sizes to make the whole matrix square. We solve it by inverting the matrix A using the formulae given in Numerical Recipes section 2.7, then multiplying the inverse by b to get x. We are not too concerned about accuracy, as this does not affect the solution found, only the route taken to find it.</p>
<p>Numerical Recipes, section 2.7, notes that A^{-1} is given by:</p>
<p>(P' Q') (R' S')</p>
<p>with:</p>
<p>P' = (P - Q.S^{-1}.R)^{-1} Q' = - (P - Q.S^{-1}.R)^{-1} . (Q.S^{-1}) R' = - (S^{-1}.R) . (P - Q.S^{-1}.R)^{-1} S' = S^{-1} + (S^{-1}.R) . (P - Q.S^{-1}.R)^{-1} . (Q.S^{-1})</p>
<p>We also make use of the fact that A is symmetric, so in particular, (S^{-1}.R) = (Q.S^{-1})^T and R' = Q'^T.</p>
<p>We are given A as a <a class="el" href="structglobal__matrix.html">global_matrix</a> and b as a <a class="el" href="structglobal__vector.html">global_vector</a>. This function destroys the original matrix and returns the solution in place of b. </p>

<p>Definition at line <a class="el" href="_ecf_global_8c_source.html#l02556">2556</a> of file <a class="el" href="_ecf_global_8c_source.html">EcfGlobal.c</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Thu Mar 13 2014 15:22:04 for SLIM Curve by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
