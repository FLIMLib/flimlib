<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>SLIM Curve: EcfSingle.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">SLIM Curve
   &#160;<span id="projectnumber">1</span>
   </div>
   <div id="projectbrief">SLIM-curve package for exponential curve fitting of spectral lifetime data.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">EcfSingle.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>SLIM Curve - Exponential Curve Fitting.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;math.h&gt;</code><br/>
<code>#include &lt;stdio.h&gt;</code><br/>
<code>#include &lt;stdlib.h&gt;</code><br/>
<code>#include &quot;EcfInternal.h&quot;</code><br/>
</div>
<p><a href="_ecf_single_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:af5f941a121d48cfb608cdd4a63a1f430"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><b>do_frees</b></td></tr>
<tr class="separator:af5f941a121d48cfb608cdd4a63a1f430"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a12f94f60ba55450a3c96ff5354f4e196"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a12f94f60ba55450a3c96ff5354f4e196"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><b>GCI_marquardt_step</b> (float x[], float y[], int ndata, <a class="el" href="_ecf_8h.html#a603ad628eaeb162f9f6326cbec927b89">noise_type</a> noise, float sig[], float param[], int paramfree[], int nparam, <a class="el" href="_ecf_8h.html#ab577c048e57126ea37f6656e97e547e7">restrain_type</a> restrain, void(*fitfunc)(float, float[], float *, float[], int), float yfit[], float dy[], float **covar, float **alpha, float *chisq, float *alambda, int *pmfit, float *pochisq, float *paramtry, float *beta, float *dparam)</td></tr>
<tr class="separator:a12f94f60ba55450a3c96ff5354f4e196"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:afb8daa724709f15dfe9b3b95d7e2c5ca"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="afb8daa724709f15dfe9b3b95d7e2c5ca"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><b>GCI_marquardt_step_instr</b> (float xincr, float y[], int ndata, int fit_start, int fit_end, float instr[], int ninstr, <a class="el" href="_ecf_8h.html#a603ad628eaeb162f9f6326cbec927b89">noise_type</a> noise, float sig[], float param[], int paramfree[], int nparam, <a class="el" href="_ecf_8h.html#ab577c048e57126ea37f6656e97e547e7">restrain_type</a> restrain, void(*fitfunc)(float, float[], float *, float[], int), float yfit[], float dy[], float **covar, float **alpha, float *chisq, float *alambda, int *pmfit, float *pochisq, float *paramtry, float *beta, float *dparam, float **pfnvals, float ***pdy_dparam_pure, float ***pdy_dparam_conv, int *pfnvals_len, int *pdy_dparam_nparam_size)</td></tr>
<tr class="separator:afb8daa724709f15dfe9b3b95d7e2c5ca"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5be7339bce1cb57d8723988385b82b5e"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a5be7339bce1cb57d8723988385b82b5e"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><b>GCI_marquardt_estimate_errors</b> (float **alpha, int nparam, int mfit, float d[], float **v, float interval)</td></tr>
<tr class="separator:a5be7339bce1cb57d8723988385b82b5e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad62c421e86238246287fc9cadf4bf171"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_ecf_single_8c.html#ad62c421e86238246287fc9cadf4bf171">GCI_triple_integral</a> (float xincr, float y[], int fit_start, int fit_end, <a class="el" href="_ecf_8h.html#a603ad628eaeb162f9f6326cbec927b89">noise_type</a> noise, float sig[], float *Z, float *A, float *tau, float *fitted, float *residuals, float *chisq, int division)</td></tr>
<tr class="memdesc:ad62c421e86238246287fc9cadf4bf171"><td class="mdescLeft">&#160;</td><td class="mdescRight">Start with an easy one: the three integral method.  <a href="#ad62c421e86238246287fc9cadf4bf171">More...</a><br/></td></tr>
<tr class="separator:ad62c421e86238246287fc9cadf4bf171"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3c72ce45f467e73bdbfdeecba86a2d3a"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a3c72ce45f467e73bdbfdeecba86a2d3a"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><b>GCI_triple_integral_instr</b> (float xincr, float y[], int fit_start, int fit_end, float instr[], int ninstr, <a class="el" href="_ecf_8h.html#a603ad628eaeb162f9f6326cbec927b89">noise_type</a> noise, float sig[], float *Z, float *A, float *tau, float *fitted, float *residuals, float *chisq, int division)</td></tr>
<tr class="separator:a3c72ce45f467e73bdbfdeecba86a2d3a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7790a7e8ebdca31efd349e44add17cd9"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_ecf_single_8c.html#a7790a7e8ebdca31efd349e44add17cd9">GCI_triple_integral_fitting_engine</a> (float xincr, float y[], int fit_start, int fit_end, float instr[], int ninstr, <a class="el" href="_ecf_8h.html#a603ad628eaeb162f9f6326cbec927b89">noise_type</a> noise, float sig[], float *Z, float *A, float *tau, float *fitted, float *residuals, float *chisq, float chisq_target)</td></tr>
<tr class="memdesc:a7790a7e8ebdca31efd349e44add17cd9"><td class="mdescLeft">&#160;</td><td class="mdescRight">The main entry point for Triple Integral or Rapid Lifetime Determination (RLD).  <a href="#a7790a7e8ebdca31efd349e44add17cd9">More...</a><br/></td></tr>
<tr class="separator:a7790a7e8ebdca31efd349e44add17cd9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5bbaf55df7653f2f443e38b6f6b1e1a9"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_ecf_single_8c.html#a5bbaf55df7653f2f443e38b6f6b1e1a9">GCI_marquardt</a> (float x[], float y[], int ndata, <a class="el" href="_ecf_8h.html#a603ad628eaeb162f9f6326cbec927b89">noise_type</a> noise, float sig[], float param[], int paramfree[], int nparam, <a class="el" href="_ecf_8h.html#ab577c048e57126ea37f6656e97e547e7">restrain_type</a> restrain, void(*fitfunc)(float, float[], float *, float[], int), float *fitted, float *residuals, float **covar, float **alpha, float *chisq, float chisq_delta, float chisq_percent, float **erraxes)</td></tr>
<tr class="memdesc:a5bbaf55df7653f2f443e38b6f6b1e1a9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Now for the non-linear least squares fitting algorithms.  <a href="#a5bbaf55df7653f2f443e38b6f6b1e1a9">More...</a><br/></td></tr>
<tr class="separator:a5bbaf55df7653f2f443e38b6f6b1e1a9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a527b18f8e48919e46f32af4889662f48"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a527b18f8e48919e46f32af4889662f48"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><b>GCI_marquardt_instr</b> (float xincr, float y[], int ndata, int fit_start, int fit_end, float instr[], int ninstr, <a class="el" href="_ecf_8h.html#a603ad628eaeb162f9f6326cbec927b89">noise_type</a> noise, float sig[], float param[], int paramfree[], int nparam, <a class="el" href="_ecf_8h.html#ab577c048e57126ea37f6656e97e547e7">restrain_type</a> restrain, void(*fitfunc)(float, float[], float *, float[], int), float *fitted, float *residuals, float **covar, float **alpha, float *chisq, float chisq_delta, float chisq_percent, float **erraxes)</td></tr>
<tr class="separator:a527b18f8e48919e46f32af4889662f48"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2f0e656f93772e14f4a879297e17556f"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_ecf_single_8c.html#a2f0e656f93772e14f4a879297e17556f">GCI_marquardt_compute_fn</a> (float x[], float y[], int ndata, <a class="el" href="_ecf_8h.html#a603ad628eaeb162f9f6326cbec927b89">noise_type</a> noise, float sig[], float param[], int paramfree[], int nparam, void(*fitfunc)(float, float[], float *, float[], int), float yfit[], float dy[], float **alpha, float beta[], float *chisq, float old_chisq, float alambda)</td></tr>
<tr class="memdesc:a2f0e656f93772e14f4a879297e17556f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Used by GCI_marquardt to evaluate the linearised fitting matrix alpha and vector beta and to calculate chi^2.  <a href="#a2f0e656f93772e14f4a879297e17556f">More...</a><br/></td></tr>
<tr class="separator:a2f0e656f93772e14f4a879297e17556f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad97ce4de715a51cf1fba23af5309e32e"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ad97ce4de715a51cf1fba23af5309e32e"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><b>GCI_marquardt_compute_fn_instr</b> (float xincr, float y[], int ndata, int fit_start, int fit_end, float instr[], int ninstr, <a class="el" href="_ecf_8h.html#a603ad628eaeb162f9f6326cbec927b89">noise_type</a> noise, float sig[], float param[], int paramfree[], int nparam, void(*fitfunc)(float, float[], float *, float[], int), float yfit[], float dy[], float **alpha, float beta[], float *chisq, float old_chisq, float alambda, float **pfnvals, float ***pdy_dparam_pure, float ***pdy_dparam_conv, int *pfnvals_len, int *pdy_dparam_nparam_size)</td></tr>
<tr class="separator:ad97ce4de715a51cf1fba23af5309e32e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa71017f42eaaac4f5246ba5c931e0838"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_ecf_single_8c.html#aa71017f42eaaac4f5246ba5c931e0838">GCI_marquardt_compute_fn_final</a> (float x[], float y[], int ndata, <a class="el" href="_ecf_8h.html#a603ad628eaeb162f9f6326cbec927b89">noise_type</a> noise, float sig[], float param[], int paramfree[], int nparam, void(*fitfunc)(float, float[], float *, float[], int), float yfit[], float dy[], float *chisq)</td></tr>
<tr class="memdesc:aa71017f42eaaac4f5246ba5c931e0838"><td class="mdescLeft">&#160;</td><td class="mdescRight">These two variants, used just before the Marquardt fitting functions terminate, compute the function values at all points, whether or not they are being fitted.  <a href="#aa71017f42eaaac4f5246ba5c931e0838">More...</a><br/></td></tr>
<tr class="separator:aa71017f42eaaac4f5246ba5c931e0838"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae3621766e57085ea7fa13b6533cd0bb8"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_ecf_single_8c.html#ae3621766e57085ea7fa13b6533cd0bb8">GCI_marquardt_compute_fn_final_instr</a> (float xincr, float y[], int ndata, int fit_start, int fit_end, float instr[], int ninstr, <a class="el" href="_ecf_8h.html#a603ad628eaeb162f9f6326cbec927b89">noise_type</a> noise, float sig[], float param[], int paramfree[], int nparam, void(*fitfunc)(float, float[], float *, float[], int), float yfit[], float dy[], float *chisq, float **pfnvals, float ***pdy_dparam_pure, float ***pdy_dparam_conv, int *pfnvals_len, int *pdy_dparam_nparam_size)</td></tr>
<tr class="memdesc:ae3621766e57085ea7fa13b6533cd0bb8"><td class="mdescLeft">&#160;</td><td class="mdescRight">And this is the variant which handles an instrument response.  <a href="#ae3621766e57085ea7fa13b6533cd0bb8">More...</a><br/></td></tr>
<tr class="separator:ae3621766e57085ea7fa13b6533cd0bb8"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a94bbfd4c5b3d3a79fd840731954f3976"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="_ecf_single_8c.html#a94bbfd4c5b3d3a79fd840731954f3976">GCI_marquardt_fitting_engine</a> (float xincr, float *trans, int ndata, int fit_start, int fit_end, float prompt[], int nprompt, <a class="el" href="_ecf_8h.html#a603ad628eaeb162f9f6326cbec927b89">noise_type</a> noise, float sig[], float param[], int paramfree[], int nparam, <a class="el" href="_ecf_8h.html#ab577c048e57126ea37f6656e97e547e7">restrain_type</a> restrain, void(*fitfunc)(float, float[], float *, float[], int), float *fitted, float *residuals, float *chisq, float **covar, float **alpha, float **erraxes, float chisq_target, float chisq_delta, int chisq_percent)</td></tr>
<tr class="memdesc:a94bbfd4c5b3d3a79fd840731954f3976"><td class="mdescLeft">&#160;</td><td class="mdescRight">GCI_marquardt_fitting_engine.  <a href="#a94bbfd4c5b3d3a79fd840731954f3976">More...</a><br/></td></tr>
<tr class="separator:a94bbfd4c5b3d3a79fd840731954f3976"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a26e45e21bc6592ea929a9b103fe9c4d2"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a26e45e21bc6592ea929a9b103fe9c4d2"></a>
void&#160;</td><td class="memItemRight" valign="bottom"><b>GCI_marquardt_cleanup</b> (void)</td></tr>
<tr class="separator:a26e45e21bc6592ea929a9b103fe9c4d2"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>SLIM Curve - Exponential Curve Fitting. </p>
<p>Based on the 2003 version of the ECF library. This has been modified to remove modified Numeric Recipes code. Also, this takes account of the fact that we may be handling Poisson noise.</p>
<p>This file contains functions for single transient analysis. Utility code is found in EcfUtil.c and global analysis code in <a class="el" href="_ecf_global_8c_source.html">EcfGlobal.c</a>. </p>

<p>Definition in file <a class="el" href="_ecf_single_8c_source.html">EcfSingle.c</a>.</p>
</div><h2 class="groupheader">Macro Definition Documentation</h2>
<a class="anchor" id="af5f941a121d48cfb608cdd4a63a1f430"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define do_frees</td>
        </tr>
      </table>
</div><div class="memdoc">
<b>Value:</b><div class="fragment"><div class="line"><span class="keywordflow">if</span> (fnvals) free(fnvals);\</div>
<div class="line">    if (dy_dparam_pure) GCI_ecf_free_matrix(dy_dparam_pure);\</div>
<div class="line">    if (dy_dparam_conv) GCI_ecf_free_matrix(dy_dparam_conv);</div>
</div><!-- fragment -->
<p>Definition at line <a class="el" href="_ecf_single_8c_source.html#l00606">606</a> of file <a class="el" href="_ecf_single_8c_source.html">EcfSingle.c</a>.</p>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="a5bbaf55df7653f2f443e38b6f6b1e1a9"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int GCI_marquardt </td>
          <td>(</td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>x</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>y</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ndata</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="_ecf_8h.html#a603ad628eaeb162f9f6326cbec927b89">noise_type</a>&#160;</td>
          <td class="paramname"><em>noise</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>sig</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>param</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>paramfree</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nparam</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="_ecf_8h.html#ab577c048e57126ea37f6656e97e547e7">restrain_type</a>&#160;</td>
          <td class="paramname"><em>restrain</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void(*)(float, float[], float *, float[], int)&#160;</td>
          <td class="paramname"><em>fitfunc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float *&#160;</td>
          <td class="paramname"><em>fitted</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float *&#160;</td>
          <td class="paramname"><em>residuals</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float **&#160;</td>
          <td class="paramname"><em>covar</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float **&#160;</td>
          <td class="paramname"><em>alpha</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float *&#160;</td>
          <td class="paramname"><em>chisq</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>chisq_delta</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>chisq_percent</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float **&#160;</td>
          <td class="paramname"><em>erraxes</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Now for the non-linear least squares fitting algorithms. </p>
<p>The process is:</p>
<ul>
<li>for Gaussian noise, use Levenberg-Marquardt directly</li>
<li>for Poisson noise, use Levenberg-Marquardt to get an initial estimate of the parameters assuming constant error variance, then use amoeba to improve the estimate, assuming that the error variance is proportional to the function value (with a minimum variance of 15 to handle the case when the Poisson distribution is not approximately Gaussian, so that the very noisy tails do not inappropriately weight the solution).</li>
</ul>
<p>This code contains two variants of the Levenberg-Marquardt method for slightly different situations. This attempts to reduce the value chi^2 of a fit between a set of data points x[0..ndata-1], y[0..ndata-1] and a nonlinear function dependent on nparam coefficients param[0..nparam-1]. In the case that the x values are equally spaced and start at zero, we can also handle convolution with an instrument response instr[0..ninstr-1] and only look at the data points from fit_start..fit_end-1. The first variant does not handle an instrument response and takes any values of x[0..ndata-1]. The second variant takes an xincr and will handle an instrument response if ninstr &gt; 0. The individual standard deviations of the errors are determined by the value of noise: if noise=NOISE_CONST, the standard deviations are constant, given by sig[0]=*sig, if noise=NOISE_GIVEN, the standard deviations are given by sig[0..ndata-1], if noise=NOISE_POISSON_DATA, the standard deviations are taken to be given by Poisson noise, and the variances are taken to be max(y[i],15), and if noise=NOISE_POISSON_FIT, the variances are taken to be max(yfit[i],15). If noise=NOISE_GAUSSIAN_FIT, the variances are taken to be yfit[i] and if noise=NOISE_MLE then a optimisation is for the maximum likelihood approximation (Laurence and Chromy in press 2010 and G. Nishimura, and M. Tamura Phys Med Biol 2005).</p>
<p>The input array paramfree[0..nparam-1] indicates by nonzero entries those components that should be held fixed at their input values. The program returns current best-fit values for the parameters param[0..nparam-1] and chi^2 = chisq. The arrays covar[0..nparam-1][0..nparam-1] and alpha[0..nparam-1][0..nparam-1] are used as working space during most isterations. Supply a routine fitfunc(x,param,yfit,dy_dparam,nparam) that evaluates the fitting function fitfunc and its derivatives dydy[1..nparam-1] with respect to the fitting parameters param at x. (See below for information about zero offsets, though.) The values of fitfunc, modified by the instrument response, are returned in the array yfit and the differences y - yfit in dy. The first call <em>must</em> provide an initial guess for the parameters param and set alambda &lt; 0 for initialisation (which then sets alambda = 0.001). If a step succeeds, chisq becomes smaller and alambda decreases by a factor of 10. You must call this routine repeatedly until convergence is achieved. Then make one final call with alambda=0 to perform cleanups and so that covar[0..nparam-1][0..nparam-1] returns the covariance matrix and alpha the curvature matrix. (Parameters held fixed will return zero covariances.)</p>
<p>One key extra piece which is particularly important in the instrument response case. The parameter param[0] is assumed to be the zero offset of the signal, which applies before and after time zero. It thus simply contributes param[0]*sum(instr) to the signal value rather than being convolved with the instrument response only from time zero. For this reason, the fitfunc should ignore param[0], as the fitting routines will handle this offset. </p>

<p>Definition at line <a class="el" href="_ecf_single_8c_source.html#l00526">526</a> of file <a class="el" href="_ecf_single_8c_source.html">EcfSingle.c</a>.</p>

</div>
</div>
<a class="anchor" id="a2f0e656f93772e14f4a879297e17556f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int GCI_marquardt_compute_fn </td>
          <td>(</td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>x</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>y</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ndata</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="_ecf_8h.html#a603ad628eaeb162f9f6326cbec927b89">noise_type</a>&#160;</td>
          <td class="paramname"><em>noise</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>sig</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>param</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>paramfree</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nparam</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void(*)(float, float[], float *, float[], int)&#160;</td>
          <td class="paramname"><em>fitfunc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>yfit</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>dy</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float **&#160;</td>
          <td class="paramname"><em>alpha</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>beta</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float *&#160;</td>
          <td class="paramname"><em>chisq</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>old_chisq</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>alambda</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Used by GCI_marquardt to evaluate the linearised fitting matrix alpha and vector beta and to calculate chi^2. </p>
<p>The equations involved are given in section 15.5 of Numerical Recipes; basically:</p>
<p>^2(param) = {i=1}^N ( (y_i-y(x_i;param)) / sigma_i )^2</p>
<p>beta_k = -1/2 (d/dparam_k)(chi^2)</p>
<p>alpha_kl = {i=1}^N (1/sigma_i^2) . (dy(x_i;param)/dparam_k) . (dy(x_i;param)/dparam_l)</p>
<p>(where all of the derivatives are partial).</p>
<p>If an instrument response is provided, we also take account of it now. We are given that:</p>
<p>observed(t) = response(t) * instr(t)</p>
<p>where response(t) is being fitted with fitfunc; it is also trivial to show that (assuming that instr(t) is known and fixed, with no dependencies on the param_k, the parameters being fitted):</p>
<p>(d/dparam_k) observed(t) = ((d/dparam_k) response(t)) * instr(t)</p>
<p>so we do not need to alter the response function in any way to determined the fitted convolved response.</p>
<p>Again there are two variants of this function, corresponding to the two variants of the Marquardt function. </p>

<p>Definition at line <a class="el" href="_ecf_single_8c_source.html#l00998">998</a> of file <a class="el" href="_ecf_single_8c_source.html">EcfSingle.c</a>.</p>

</div>
</div>
<a class="anchor" id="aa71017f42eaaac4f5246ba5c931e0838"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int GCI_marquardt_compute_fn_final </td>
          <td>(</td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>x</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>y</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ndata</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="_ecf_8h.html#a603ad628eaeb162f9f6326cbec927b89">noise_type</a>&#160;</td>
          <td class="paramname"><em>noise</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>sig</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>param</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>paramfree</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nparam</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void(*)(float, float[], float *, float[], int)&#160;</td>
          <td class="paramname"><em>fitfunc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>yfit</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>dy</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float *&#160;</td>
          <td class="paramname"><em>chisq</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>These two variants, used just before the Marquardt fitting functions terminate, compute the function values at all points, whether or not they are being fitted. </p>
<p>(All points are fitted in the non-instrument response variant.) They also compute the residuals y - yfit at all of those points and compute a chi-squared value which is not modified at small data values in the POISSON noise models. They do not calculate alpha or beta. </p>

<p>Definition at line <a class="el" href="_ecf_single_8c_source.html#l01482">1482</a> of file <a class="el" href="_ecf_single_8c_source.html">EcfSingle.c</a>.</p>

</div>
</div>
<a class="anchor" id="ae3621766e57085ea7fa13b6533cd0bb8"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int GCI_marquardt_compute_fn_final_instr </td>
          <td>(</td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>xincr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>y</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ndata</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>fit_start</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>fit_end</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>instr</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ninstr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="_ecf_8h.html#a603ad628eaeb162f9f6326cbec927b89">noise_type</a>&#160;</td>
          <td class="paramname"><em>noise</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>sig</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>param</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>paramfree</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nparam</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void(*)(float, float[], float *, float[], int)&#160;</td>
          <td class="paramname"><em>fitfunc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>yfit</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>dy</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float *&#160;</td>
          <td class="paramname"><em>chisq</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float **&#160;</td>
          <td class="paramname"><em>pfnvals</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float ***&#160;</td>
          <td class="paramname"><em>pdy_dparam_pure</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float ***&#160;</td>
          <td class="paramname"><em>pdy_dparam_conv</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>pfnvals_len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int *&#160;</td>
          <td class="paramname"><em>pdy_dparam_nparam_size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>And this is the variant which handles an instrument response. </p>
<p>We assume that the function values are sensible. Note also that we have to be careful about which points which include in the chi-squared calculation. Also, we are guaranteed that the initialisation of the convolution arrays has been performed. </p>

<p>Definition at line <a class="el" href="_ecf_single_8c_source.html#l01611">1611</a> of file <a class="el" href="_ecf_single_8c_source.html">EcfSingle.c</a>.</p>

</div>
</div>
<a class="anchor" id="a94bbfd4c5b3d3a79fd840731954f3976"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int GCI_marquardt_fitting_engine </td>
          <td>(</td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>xincr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float *&#160;</td>
          <td class="paramname"><em>trans</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ndata</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>fit_start</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>fit_end</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>prompt</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nprompt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="_ecf_8h.html#a603ad628eaeb162f9f6326cbec927b89">noise_type</a>&#160;</td>
          <td class="paramname"><em>noise</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>sig</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>param</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>paramfree</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>nparam</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="_ecf_8h.html#ab577c048e57126ea37f6656e97e547e7">restrain_type</a>&#160;</td>
          <td class="paramname"><em>restrain</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void(*)(float, float[], float *, float[], int)&#160;</td>
          <td class="paramname"><em>fitfunc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float *&#160;</td>
          <td class="paramname"><em>fitted</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float *&#160;</td>
          <td class="paramname"><em>residuals</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float *&#160;</td>
          <td class="paramname"><em>chisq</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float **&#160;</td>
          <td class="paramname"><em>covar</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float **&#160;</td>
          <td class="paramname"><em>alpha</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float **&#160;</td>
          <td class="paramname"><em>erraxes</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>chisq_target</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>chisq_delta</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>chisq_percent</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>GCI_marquardt_fitting_engine. </p>
<p>The main entry point for LM and MLE fitting.</p>
<p>This returns the number of iterations or negative if an error occurred. passes all the data to the ecf routine, checks the returned chisq and re-fits if it is of benefit was DoEcfFittingEngine() included in <a class="el" href="_ecf_single_8c.html" title="SLIM Curve - Exponential Curve Fitting. ">EcfSingle.c</a> by PRB, 3.9.03 </p>

<p>Definition at line <a class="el" href="_ecf_single_8c_source.html#l01860">1860</a> of file <a class="el" href="_ecf_single_8c_source.html">EcfSingle.c</a>.</p>

</div>
</div>
<a class="anchor" id="ad62c421e86238246287fc9cadf4bf171"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int GCI_triple_integral </td>
          <td>(</td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>xincr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>y</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>fit_start</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>fit_end</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="_ecf_8h.html#a603ad628eaeb162f9f6326cbec927b89">noise_type</a>&#160;</td>
          <td class="paramname"><em>noise</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>sig</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float *&#160;</td>
          <td class="paramname"><em>Z</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float *&#160;</td>
          <td class="paramname"><em>A</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float *&#160;</td>
          <td class="paramname"><em>tau</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float *&#160;</td>
          <td class="paramname"><em>fitted</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float *&#160;</td>
          <td class="paramname"><em>residuals</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float *&#160;</td>
          <td class="paramname"><em>chisq</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>division</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Start with an easy one: the three integral method. </p>
<p>This returns 0 on success, negative on error. </p>

<p>Definition at line <a class="el" href="_ecf_single_8c_source.html#l00077">77</a> of file <a class="el" href="_ecf_single_8c_source.html">EcfSingle.c</a>.</p>

</div>
</div>
<a class="anchor" id="a7790a7e8ebdca31efd349e44add17cd9"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int GCI_triple_integral_fitting_engine </td>
          <td>(</td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>xincr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>y</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>fit_start</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>fit_end</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>instr</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>ninstr</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="_ecf_8h.html#a603ad628eaeb162f9f6326cbec927b89">noise_type</a>&#160;</td>
          <td class="paramname"><em>noise</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>sig</em>[], </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float *&#160;</td>
          <td class="paramname"><em>Z</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float *&#160;</td>
          <td class="paramname"><em>A</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float *&#160;</td>
          <td class="paramname"><em>tau</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float *&#160;</td>
          <td class="paramname"><em>fitted</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float *&#160;</td>
          <td class="paramname"><em>residuals</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float *&#160;</td>
          <td class="paramname"><em>chisq</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>chisq_target</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>The main entry point for Triple Integral or Rapid Lifetime Determination (RLD). </p>
<p>Uses GCI_triple_integral_*() to fit repeatedly with different integration periods until chisq_target is met or a maximum number of iterations are used.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">xincr</td><td>The time increment inbetween the values in the y array. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">y</td><td>The transient (time resolved) signal to be analysed, the 'data'. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">fit_start</td><td>The index into the y array marking the start to the data to be used in the fit. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">fit_end</td><td>The index into the y array marking the end of the data to be used in the fit. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">instr</td><td>The instrument reponse (IRF) or prompt signal to be used (optional, can pass NULL). </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">noise</td><td>The noise_type to be used. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">sig</td><td>The standard deviation at each data point in y if noise_type NOISE_GIVEN is used (optional, can pass NULL). </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">Z</td><td>The returned background value from the fit. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">A</td><td>The returned amplitude value from the fit. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">tau</td><td>The returned lifetime value from the fit. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">fitted</td><td>An array containing values fitted to the data, the 'fit'. Fit points are coincident in time with the data points. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">residuals</td><td>An array containing the difference between the data and the fit. </td></tr>
    <tr><td class="paramdir">[out]</td><td class="paramname">chisq</td><td>The resulting raw chi squared value of the fit. To get the reduced chisq, divide by the degrees of freedom (fit_start - fit_end - nparam) </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">chisq_target</td><td>A raw chi squared value to aim for. If this value is reached fitting will stop. If you want to aim for a reduced chisq (say 1.1 or 1.0) you must multiply by the degree of freedom. (TRI2: "Try refits") </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>An error code, 0 = success. </dd></dl>

<p>Definition at line <a class="el" href="_ecf_single_8c_source.html#l00381">381</a> of file <a class="el" href="_ecf_single_8c_source.html">EcfSingle.c</a>.</p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Tue Mar 11 2014 15:45:15 for SLIM Curve by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
